{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "name": {
            "type": "string"
        },
        "additional_host_name": {
            "type": "string",
            "metadata": {
              "description": "An additional hostname this application should be accessible on"
            }
          }
    },
    "variables": {
        "additional_host_name_resource": "[concat(parameters('name'), '/', if(equals(parameters('additional_host_name'),''),'default',parameters('additional_host_name')))]"
      },
"resources": [
{
    "type": "Microsoft.Network/trafficManagerProfiles",
    "name": "[parameters('name')]",
    "apiVersion": "2017-05-01",
    "location": "global",
    "properties": {
        "profileStatus": "Enabled",
        "trafficRoutingMethod": "Priority",
        "dnsConfig": {
            "relativeName": "[concat('hmcts-', parameters('name'))]",
            "fqdn": "[concat('hmcts-', parameters('name'),'.trafficmanager.net')]",
            "ttl": 100
        },
        "monitorConfig": {
            "protocol": "HTTP",
            "port": 80,
            "path": "/",
            "intervalInSeconds": 30,
            "toleratedNumberOfFailures": 3,
            "timeoutInSeconds": 10
        },
        "endpoints": [
            {
                "name": "shutter",
                "type": "Microsoft.Network/trafficManagerProfiles/azureEndpoints",
                "properties": {
                    "endpointStatus": "Enabled",
                    "targetResourceId": "[resourceId('mojmaintenancepage', 'Microsoft.Web/sites', 'mojmaintenance')]",
                    "target": "mojmaintenance.azurewebsites.net",
                    "weight": 2,
                    "priority": 2,
                    "endpointLocation": "UK South"
                }
            },
            {
                "condition": "[not(equals(parameters('additional_host_name'), ''))]",
                "name": "[variables('additional_host_name_resource')]",
                "name": "app",
                "type": "Microsoft.Network/trafficManagerProfiles/azureEndpoints",
                "properties": {
                    "endpointStatus": "Enabled",
                    "target": "[parameters('additional_host_name')]",
                    "weight": 1,
                    "priority": 1,
                    "endpointLocation": "UK South"
                }
            }
        ]
    },
    "dependsOn": []
  }
]
}